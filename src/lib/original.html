<!doctype html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cosmic Clicker</title>
  <style>
    :root {
      --primary-bg: #0f1729;
      --secondary-bg: #1a2942;
      --panel-bg: #263654;
      --accent: #5e72e4;
      --accent-hover: #4a5bd0;
      --text: #e0e6ed;
      --text-secondary: #a0aec0;
      --energy-color: #64e9ff;
      --stardust-color: #ffbb00;
      --prestige-color: #fb6ed3;
      --green: #2dce89;
      --red: #f5365c;
      --tooltip-bg: rgba(0, 0, 0, 0.8);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: var(--primary-bg);
      color: var(--text);
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      line-height: 1.6;
      overflow-x: hidden;
      background-image:
        radial-gradient(circle at 25% 25%, rgba(94, 114, 228, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 75% 75%, rgba(66, 153, 225, 0.1) 0%, transparent 50%);
    }

    .sparkle {
      position: absolute;
      width: 6px;
      height: 6px;
      background: radial-gradient(circle, #fff, #88f9ff, transparent);
      border-radius: 50%;
      pointer-events: none;
      animation: sparkle-fade 0.5s ease-out forwards;
      z-index: 5;
    }

    @keyframes sparkle-fade {
      0% {
        transform: scale(1);
        opacity: 1;
      }

      100% {
        transform: scale(0.5);
        opacity: 0;
      }
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 20px;
      display: grid;
      grid-template-columns: 3fr 2fr;
      gap: 20px;
      min-height: 100vh;
    }

    header {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding-bottom: 15px;
      border-bottom: 1px solid var(--accent);
    }

    .settings-icon {
      cursor: pointer;
      font-size: 24px;
      padding: 5px;
      border-radius: 5px;
      transition: background-color 0.2s;
    }

    .settings-icon:hover {
      background-color: var(--panel-bg);
    }

    .tabs {
      display: flex;
      gap: 10px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .tab {
      padding: 10px 15px;
      background-color: var(--secondary-bg);
      border-radius: 8px 8px 0 0;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .tab.active {
      background-color: var(--panel-bg);
      color: var(--accent);
    }

    .tab:hover:not(.active) {
      background-color: #223047;
    }

    .tab-content {
      display: none;
      background-color: var(--panel-bg);
      border-radius: 0 8px 8px 8px;
      padding: 20px;
      height: calc(100% - 55px);
      overflow-y: auto;
    }

    .tab-content.active {
      display: block;
    }

    .main-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .resources {
      background-color: var(--panel-bg);
      border-radius: 8px;
      padding: 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .resource {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 5px 0;
    }

    .resource-name {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .resource-icon {
      font-size: 20px;
    }

    .energy .resource-icon {
      color: var(--energy-color);
    }

    .stardust .resource-icon {
      color: var(--stardust-color);
    }

    .prestige .resource-icon {
      color: var(--prestige-color);
    }

    .resource-value {
      font-weight: bold;
      font-size: 1.1em;
    }

    .per-second {
      font-size: 0.8em;
      color: var(--text-secondary);
    }

    .clicker-area {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 20px;
      text-align: center;
      background-color: var(--panel-bg);
      border-radius: 8px;
      padding: 20px;
      flex-grow: 1;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .clicker-button {
      width: 180px;
      height: 180px;
      border-radius: 50%;
      border: none;
      background: radial-gradient(circle, var(--energy-color) 0%, var(--accent) 100%);
      box-shadow: 0 0 30px rgba(94, 114, 228, 0.5);
      cursor: pointer;
      color: var(--primary-bg);
      font-size: 24px;
      font-weight: bold;
      transition:
        transform 0.1s,
        box-shadow 0.2s;
      position: relative;
      overflow: hidden;
    }

    .clicker-button:hover {
      box-shadow: 0 0 40px rgba(94, 114, 228, 0.7);
    }

    .clicker-button:active {
      transform: scale(0.95);
    }

    .clicker-button::before {
      content: '';
      position: absolute;
      top: -50%;
      left: -50%;
      width: 200%;
      height: 200%;
      background: conic-gradient(transparent, rgba(255, 255, 255, 0.3), transparent 30%);
      animation: rotate 4s linear infinite;
    }

    @keyframes rotate {
      100% {
        transform: rotate(360deg);
      }
    }

    .click-value,
    .auto-click-value {
      font-size: 1.2em;
      color: var(--accent);
    }

    .side-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .panel {
      background-color: var(--panel-bg);
      border-radius: 8px;
      padding: 15px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .panel-title {
      font-size: 1.2em;
      margin-bottom: 15px;
      color: var(--accent);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel-subtitle {
      font-size: 0.9em;
      color: var(--text-secondary);
      margin-bottom: 15px;
    }

    .upgrade {
      background-color: var(--secondary-bg);
      border-radius: 6px;
      padding: 12px;
      margin-bottom: 10px;
      cursor: pointer;
      position: relative;
      transition:
        transform 0.1s,
        background-color 0.2s;
      display: flex;
      justify-content: space-between;
      overflow: hidden;
      border: 1px solid #3a4d6b;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .upgrade:hover {
      background-color: #2a3958;
      border-color: var(--accent);
    }

    .upgrade.disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .upgrade.equipped {
      border-color: var(--green);
      background-color: #263b46;
    }

    .upgrade-info {
      flex-grow: 1;
    }

    .upgrade-name {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 5px;
    }

    .upgrade-icon {
      font-size: 18px;
    }

    .upgrade-level {
      font-size: 0.8em;
      color: var(--text-secondary);
      background-color: var(--primary-bg);
      padding: 2px 6px;
      border-radius: 10px;
    }

    .upgrade-desc {
      font-size: 0.85em;
      color: var(--text-secondary);
      margin-bottom: 5px;
    }

    .upgrade-effect {
      font-size: 0.85em;
      color: var(--green);
    }

    .upgrade-cost {
      display: flex;
      align-items: center;
      gap: 4px;
      font-weight: bold;
      padding: 5px 12px;
      background-color: var(--primary-bg);
      border-radius: 15px;
      font-size: 0.9em;
      height: fit-content;
    }

    .affordable {
      color: var(--green);
    }

    .not-affordable {
      color: var(--red);
    }

    .equipped {
      color: var(--green);
    }

    .progress-bar {
      height: 6px;
      background-color: var(--primary-bg);
      border-radius: 3px;
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      transition: width 0.5s;
    }

    .notification {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background-color: var(--accent);
      color: white;
      padding: 15px 20px;
      border-radius: 8px;
      z-index: 100;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      transform: translateX(120%);
      transition: transform 0.3s;
      max-width: 300px;
    }

    .notification.show {
      transform: translateX(0);
    }

    .notification-title {
      font-weight: bold;
      margin-bottom: 5px;
    }

    .modal {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.7);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 200;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
    }

    .modal.active {
      opacity: 1;
      pointer-events: all;
    }

    .modal-content {
      background-color: var(--panel-bg);
      border-radius: 8px;
      padding: 25px;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.5);
      position: relative;
    }

    .modal-title {
      font-size: 1.5em;
      margin-bottom: 20px;
      color: var(--accent);
    }

    .close-modal {
      position: absolute;
      top: 15px;
      right: 15px;
      background: none;
      border: none;
      color: var(--text-secondary);
      font-size: 1.5em;
      cursor: pointer;
    }

    .modal-button {
      padding: 10px 18px;
      border: none;
      border-radius: 6px;
      background-color: var(--accent);
      color: white;
      font-weight: bold;
      cursor: pointer;
      transition: background-color 0.2s;
    }

    .modal-button:hover {
      background-color: var(--accent-hover);
    }

    .modal-button:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .modal-button.danger {
      background-color: var(--red);
    }

    .modal-button.danger:hover {
      background-color: #e02f54;
    }

    .button-row {
      display: flex;
      justify-content: flex-end;
      gap: 15px;
      margin-top: 25px;
    }

    .achievements-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
    }

    .achievement {
      background-color: var(--secondary-bg);
      border-radius: 8px;
      padding: 15px;
      text-align: center;
      transition: transform 0.2s;
    }

    .achievement.unlocked {
      background-color: #2d4263;
    }

    .achievement-icon {
      font-size: 24px;
      margin-bottom: 10px;
      opacity: 0.3;
    }

    .achievement.unlocked .achievement-icon {
      opacity: 1;
      color: var(--accent);
    }

    .achievement-name {
      font-size: 0.9em;
      margin-bottom: 5px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .achievement-desc {
      font-size: 0.8em;
      color: var(--text-secondary);
    }

    .achievement.locked .achievement-name,
    .achievement.locked .achievement-desc {
      opacity: 0.6;
    }

    .pop-effect {
      position: absolute;
      pointer-events: none;
      user-select: none;
      color: var(--energy-color);
      font-weight: bold;
      z-index: 10;
      text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
      animation: pop-and-fade 1.5s ease-out forwards;
    }

    @keyframes pop-and-fade {
      0% {
        opacity: 0;
        transform: translateY(0) scale(0.5);
      }

      10% {
        opacity: 1;
        transform: translateY(-5px) scale(1.2);
      }

      100% {
        opacity: 0;
        transform: translateY(-50px) scale(0.8);
      }
    }

    .tooltip {
      position: relative;
    }

    .tooltip .tooltip-text {
      visibility: hidden;
      background-color: var(--tooltip-bg);
      color: var(--text);
      text-align: center;
      border-radius: 6px;
      padding: 10px;
      position: absolute;
      z-index: 1;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      opacity: 0;
      transition: opacity 0.3s;
      pointer-events: none;
      width: 200px;
    }

    .tooltip:hover .tooltip-text {
      visibility: visible;
      opacity: 1;
    }

    .prestige-button {
      padding: 12px 20px;
      background: linear-gradient(135deg, var(--prestige-color) 0%, #9c27b0 100%);
      border: none;
      border-radius: 8px;
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      margin-top: 15px;
      width: 100%;
      box-shadow: 0 4px 10px rgba(251, 110, 211, 0.3);
      transition:
        transform 0.2s,
        box-shadow 0.2s;
    }

    .prestige-button:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 6px 14px rgba(251, 110, 211, 0.4);
    }

    .prestige-button:disabled {
      background: linear-gradient(135deg, #a76b9f 0%, #6b4473 100%);
      cursor: not-allowed;
      opacity: 0.7;
    }

    .prestige-info {
      margin-bottom: 15px;
      text-align: center;
    }

    .prestige-reward {
      color: var(--prestige-color);
      font-weight: bold;
    }

    .research-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
    }

    .research-item {
      background-color: var(--secondary-bg);
      border-radius: 8px;
      padding: 15px;
      transition: transform 0.2s;
      cursor: pointer;
      position: relative;
      overflow: hidden;
    }

    .research-item.researched {
      background-color: #2d4263;
    }

    .research-item.in-progress {
      background-color: #3a4d6b;
    }

    .research-item.locked {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .research-item.equipped {
      background-color: #263b46;
      border: 1px solid var(--green);
    }

    .research-name {
      font-weight: bold;
      margin-bottom: 5px;
      color: var(--accent);
    }

    .research-desc {
      font-size: 0.85em;
      margin-bottom: 10px;
      color: var(--text-secondary);
    }

    .research-cost {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 0.9em;
    }

    .research-progress {
      height: 5px;
      background-color: var(--primary-bg);
      border-radius: 3px;
      margin-top: 10px;
      overflow: hidden;
    }

    .research-progress-bar {
      height: 100%;
      background-color: var(--accent);
      width: 0%;
      transition: width 0.5s;
    }

    .star-system {
      position: relative;
      width: 100%;
      height: 200px;
      background-color: var(--primary-bg);
      border-radius: 8px;
      overflow: hidden;
      margin-bottom: 20px;
    }

    .star {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: 50px;
      height: 50px;
      background: radial-gradient(circle, #fff6d5 20%, #ffbb00 50%, transparent 100%);
      border-radius: 50%;
      box-shadow:
        0 0 30px #ffbb00,
        0 0 60px rgba(255, 187, 0, 0.5);
    }

    .planet {
      position: absolute;
      top: 50%;
      left: 50%;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      transform: translate(-50%, -50%);
      animation: orbit linear infinite;
    }

    .orbit-container {
      position: absolute;
      top: 50%;
      left: 50%;
      transform-origin: center;
      transform: translate(-50%, -50%);
    }

    .planet-1-container {
      animation: orbit 15s linear infinite;
    }

    .planet-2-container {
      animation: orbit 25s linear infinite;
    }

    .planet-3-container {
      animation: orbit 35s linear infinite;
    }

    @keyframes orbit {
      0% {
        transform: translate(-50%, -50%) rotate(0deg);
      }

      100% {
        transform: translate(-50%, -50%) rotate(360deg);
      }
    }

    .planet-1 {
      background: radial-gradient(circle, #63b3ed 0%, #3182ce 100%);
      box-shadow: 0 0 10px rgba(49, 130, 206, 0.7);
      margin-left: 60px;
      animation-duration: 15s;
    }

    .planet-2 {
      background: radial-gradient(circle, #f6ad55 0%, #dd6b20 100%);
      box-shadow: 0 0 10px rgba(221, 107, 32, 0.7);
      margin-left: 110px;
      animation-duration: 25s;
    }

    .planet-3 {
      background: radial-gradient(circle, #68d391 0%, #38a169 100%);
      box-shadow: 0 0 10px rgba(56, 161, 105, 0.7);
      margin-left: 160px;
      animation-duration: 35s;
    }

    @keyframes orbit {
      from {
        transform: rotate(0deg) translateY(-50%);
      }

      to {
        transform: rotate(360deg) translateY(-50%);
      }
    }

    .stars-bg {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      pointer-events: none;
      z-index: -1;
    }

    .star-bg {
      position: absolute;
      background-color: white;
      border-radius: 50%;
      animation: twinkle linear infinite;
    }

    @keyframes twinkle {
      0% {
        opacity: 0.1;
      }

      50% {
        opacity: 0.7;
      }

      100% {
        opacity: 0.1;
      }
    }

    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
      }

      .research-grid {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 600px) {
      .tabs {
        flex-wrap: wrap;
      }

      .clicker-button {
        width: 150px;
        height: 150px;
      }

      .star-system {
        height: 150px;
      }
    }
  </style>
</head>

<body>
  <div class="stars-bg" id="starsBg"></div>
  <div class="container">
    <header>
      <h1>Cosmic Clicker</h1>
      <div>
        <div class="settings-icon" id="settingsButton">‚öôÔ∏è</div>
      </div>
    </header>
    <div class="main-panel">
      <div class="resources">
        <div class="resource energy">
          <div class="resource-name">
            <div class="resource-icon">‚ú®</div>
            <div>Cosmic Energy</div>
          </div>
          <div>
            <div class="resource-value" id="energyValue">0</div>
            <div class="per-second" id="energyPerSecond">0 per second</div>
          </div>
        </div>
        <div class="resource stardust" id="stardustResource" style="display: none">
          <div class="resource-name">
            <div class="resource-icon">‚≠ê</div>
            <div>Stardust</div>
          </div>
          <div>
            <div class="resource-value" id="stardustValue">0</div>
            <div class="per-second" id="stardustPerSecond">0 per second</div>
          </div>
        </div>
        <div class="resource prestige" id="prestigeResource" style="display: none">
          <div class="resource-name">
            <div class="resource-icon">üå†</div>
            <div>Celestial Power</div>
          </div>
          <div class="resource-value" id="prestigeValue">0</div>
        </div>
      </div>
      <div class="star-system">
        <div class="star"></div>

        <div class="orbit-container planet-1-container">
          <div class="planet planet-1"></div>
        </div>

        <div class="orbit-container planet-2-container">
          <div class="planet planet-2"></div>
        </div>

        <div class="orbit-container planet-3-container">
          <div class="planet planet-3"></div>
        </div>
      </div>
      <div class="clicker-area">
        <button class="clicker-button" id="clickerButton">Collect</button>
        <div>
          Click to collect <span class="click-value" id="clickValue">1</span> cosmic energy
        </div>
        <div>
          Automatically collecting
          <span class="auto-click-value" id="autoClickValue">0</span> cosmic energy per second
        </div>
      </div>
    </div>
    <div class="side-panel">
      <div class="tabs">
        <div class="tab active" data-tab="upgrades">Upgrades</div>
        <div class="tab" data-tab="research">Research</div>
        <div class="tab" data-tab="prestige" id="ascensionTab" style="display: none">
          Ascension
        </div>
        <div class="tab" data-tab="achievements">Achievements</div>
      </div>
      <div class="tab-content active" id="upgradesTab">
        <div class="panel-subtitle">Purchase upgrades to increase your energy production.</div>
        <div id="upgradesContainer"></div>
      </div>
      <div class="tab-content" id="researchTab">
        <div class="panel-subtitle">
          Research new technologies to unlock special abilities and bonuses. Research is permanent
          and unlocks new features or boosts.
        </div>
        <div id="researchInProgressSection"></div>
        <div id="availableResearchSection"></div>
        <div id="completedResearchSection"></div>
      </div>
      <div class="tab-content" id="prestigeTab">
        <div class="panel-subtitle">
          Ascend to a higher plane of existence and gain powerful bonuses.
        </div>
        <div class="prestige-info">
          You need at least <span class="prestige-threshold">25,000</span> cosmic energy to
          ascend. <br /><br />
          Current reward: <span class="prestige-reward" id="prestigeReward">0</span> Celestial
          Power
          <br />
          Each Celestial Power gives you a 10% permanent boost to all energy production.
        </div>
        <button class="prestige-button" id="prestigeButton" disabled>Ascend</button>
      </div>
      <div class="tab-content" id="achievementsTab">
        <div class="panel-subtitle">Complete achievements to earn permanent bonuses.</div>
        <div class="achievements-grid" id="achievementsContainer"></div>
      </div>
      <div class="tab-content" id="artifactsTab">
        <div class="panel-subtitle">
          Discover and equip powerful artifacts to enhance your production.
        </div>
        <div id="artifactChancesPanel"></div>
        <button class="modal-button" id="discoverArtifactButton" style="margin-top: 10px; width: 100%" disabled>
          Discover Artifact (100 Stardust)
        </button>
        <div class="artifacts-container" id="artifactsContainer"></div>
        <div class="panel-subtitle" style="margin-top: 20px">Equipped Artifacts:</div>
        <div class="equipped-artifacts" id="equippedArtifacts"></div>
      </div>
    </div>
  </div>
  <div class="modal" id="settingsModal">
    <div class="modal-content">
      <button class="close-modal" id="closeSettings">&times;</button>
      <h2 class="modal-title">Settings</h2>
      <p>Game version: 1.2</p>
      <div class="button-row">
        <button class="modal-button danger" id="resetButton">Reset Game</button>
        <button class="modal-button" id="saveButton">Save Game</button>
        <button class="modal-button" id="exportSaveButton">Export Save</button>
        <button class="modal-button" id="importSaveButton">Import Save</button>
      </div>
    </div>
  </div>
  <div class="modal" id="resetConfirmModal">
    <div class="modal-content">
      <h2 class="modal-title">Reset Game?</h2>
      <p>Are you sure you want to reset all progress? This cannot be undone.</p>
      <div class="button-row">
        <button class="modal-button" id="cancelResetButton">Cancel</button>
        <button class="modal-button danger" id="confirmResetButton">Yes, Reset</button>
      </div>
    </div>
  </div>
  <div class="notification" id="notification">
    <div class="notification-title" id="notificationTitle">Title</div>
    <div class="notification-message" id="notificationMessage">Message</div>
  </div>
  <div class="modal" id="importModal">
    <div class="modal-content">
      <button class="close-modal" id="closeImportModal">&times;</button>
      <h2 class="modal-title">Import Save</h2>
      <textarea id="importBase64Input" style="width: 100%; height: 100px; resize: vertical"
        placeholder="Paste your base64 save string here..."></textarea>
      <div class="button-row">
        <button class="modal-button" id="importBase64Button">Import</button>
      </div>
    </div>
  </div>
  <div class="modal" id="exportModal">
    <div class="modal-content">
      <button class="close-modal" id="closeExportModal">&times;</button>
      <h2 class="modal-title">Export Save</h2>
      <textarea id="exportBase64Output" style="width: 100%; height: 100px; resize: vertical" readonly></textarea>
      <div class="button-row">
        <button class="modal-button" id="copyExportBase64Button">Copy</button>
        <button class="modal-button" id="downloadExportBase64Button">Download as File</button>
      </div>
    </div>
  </div>
  <script>
    let gameState = {
      energy: 0,
      energyPerClick: 1,
      energyPerSecond: 0,
      stardust: 0,
      stardustPerSecond: 0,
      prestigePoints: 0,
      prestigeMultiplier: 1,
      totalClicks: 0,
      totalEnergy: 0,
      lastUpdate: Date.now(),
      lastSave: Date.now(),
      researchPoints: 0,
      researchPointsPerSecond: 0,
      starSystemLevel: 1,
      activeResearch: null,
      researchProgress: 0,
      achievements: {},
      upgrades: {},
      research: {},
      unlocked: {stardust: false, research: false, prestige: false},
      artifactSlots: [],
      artifacts: [],
      researchSpeedMultiplier: 1
    };
    const config = {
      autosaveInterval: 30000,
      updateInterval: 1000,
      offlineProgressMax: 24 * 60 * 60 * 1000,
      prestigeRequirement: 25000,
      prestigePointsFormula: (energy) =>
        Math.floor(Math.sqrt((gameState.totalEnergy || 0) / 2500)),
      clickMultiplier: 1,
      stardustUnlockEnergy: 5000,
      researchPointMultiplier: 1
    };
    const upgradeDefinitions = [
      {
        id: 'energyCollector',
        name: 'Energy Collector',
        description: 'A basic device that collects cosmic energy.',
        icon: 'üì°',
        baseCost: 15,
        costGrowth: 1.18,
        baseProduction: 0.05,
        productionGrowth: 0.05,
        unlockRequirement: 0
      },
      {
        id: 'energyCapacitor',
        name: 'Energy Capacitor',
        description: 'Increases the amount of energy per click.',
        icon: 'üîã',
        baseCost: 75,
        costGrowth: 1.25,
        clickIncrease: 1,
        unlockRequirement: 0
      },
      {
        id: 'orbitalSatellite',
        name: 'Orbital Satellite',
        description: 'Collects energy from orbit.',
        icon: 'üõ∞Ô∏è',
        baseCost: 350,
        costGrowth: 1.18,
        baseProduction: 0.5,
        productionGrowth: 0.25,
        unlockRequirement: 150
      },
      {
        id: 'quantumExtractor',
        name: 'Quantum Extractor',
        description: 'Uses quantum fields to extract energy from space-time.',
        icon: '‚öõÔ∏è',
        baseCost: 1500,
        costGrowth: 1.2,
        baseProduction: 2,
        productionGrowth: 0.5,
        unlockRequirement: 750
      },
      {
        id: 'cosmicCondenser',
        name: 'Cosmic Condenser',
        description: 'Condenses cosmic radiation into pure energy.',
        icon: 'üåÄ',
        baseCost: 7500,
        costGrowth: 1.22,
        baseProduction: 5,
        productionGrowth: 1,
        unlockRequirement: 3000
      },
      {
        id: 'wormholeHarvester',
        name: 'Wormhole Harvester',
        description: 'Extracts energy from microscopic wormholes.',
        icon: 'üï≥Ô∏è',
        baseCost: 35000,
        costGrowth: 1.25,
        baseProduction: 12,
        productionGrowth: 2.5,
        unlockRequirement: 15000
      },
      {
        id: 'nebulaConverter',
        name: 'Nebula Converter',
        description: 'Converts nebula gases into pure cosmic energy.',
        icon: '‚òÅÔ∏è',
        baseCost: 150000,
        costGrowth: 1.27,
        baseProduction: 30,
        productionGrowth: 6,
        unlockRequirement: 50000
      },
      {
        id: 'stardustCollector',
        name: 'Stardust Collector',
        description: 'Generates stardust from cosmic energy.',
        icon: '‚≠ê',
        baseCost: 250000,
        costGrowth: 1.3,
        stardustProduction: 0.1,
        stardustGrowth: 0.05,
        unlockRequirement: 100000,
        requiresResearch: 'stardustGeneration'
      }
    ];
    const researchDefinitions = [
      {
        id: 'improvedCollection',
        name: 'Improved Collection',
        description: 'Improves energy collection efficiency by 20%.',
        cost: 200,
        duration: 120,
        unlockRequirement: 0,
        effect: () => {
          gameState.energyPerSecond *= 1.2;
          showNotification('Research Complete', 'Improved Collection is now active.');
        }
      },
      {
        id: 'enhancedClicking',
        name: 'Enhanced Clicking',
        description: 'Increases energy per click by 30%.',
        cost: 400,
        duration: 180,
        unlockRequirement: 0,
        effect: () => {
          gameState.energyPerClick *= 1.3;
          showNotification('Research Complete', 'Enhanced Clicking is now active.');
        }
      },
      {
        id: 'stardustGeneration',
        name: 'Stardust Generation',
        description: 'Allows the collection of Stardust, a rare resource.',
        cost: 750,
        duration: 300,
        unlockRequirement: 2000,
        effect: () => {
          gameState.unlocked.stardust = true;
          document.getElementById('stardustResource').style.display = 'flex';
          showNotification('Research Complete', 'You can now collect Stardust!');
        }
      },
      {
        id: 'prestige',
        name: 'Ascension Technology',
        description: 'Allows you to ascend and gain permanent bonuses.',
        cost: 3000,
        duration: 450,
        unlockRequirement: 10000,
        effect: () => {
          gameState.unlocked.prestige = true;
          document.getElementById('prestigeResource').style.display = 'flex';
          document.getElementById('ascensionTab').style.display = '';
          showNotification('Research Complete', 'You can now Ascend for permanent bonuses!');
        }
      },
      {
        id: 'efficientResearch',
        name: 'Efficient Research',
        description: 'Increases research speed by 25%.',
        cost: 1200,
        duration: 240,
        unlockRequirement: 5000,
        effect: () => {
          gameState.researchSpeedMultiplier *= 1.25;
          showNotification('Research Complete', 'Research now completes 25% faster!');
        }
      },
      {
        id: 'stardustEfficiency',
        name: 'Stardust Efficiency',
        description: 'Increases stardust production by 50%.',
        cost: 2500,
        duration: 360,
        unlockRequirement: 12000,
        requiresResearch: 'stardustGeneration',
        effect: () => {
          gameState.stardustPerSecond *= 1.5;
          showNotification('Research Complete', 'Stardust production increased by 50%!');
        }
      },
      {
        id: 'celestialHarmonics',
        name: 'Celestial Harmonics',
        description: 'Increases prestige points gained by 20%.',
        cost: 5000,
        duration: 600,
        unlockRequirement: 20000,
        requiresResearch: 'prestige',
        effect: () => {
          config.prestigePointsFormula = (energy) => Math.floor(Math.sqrt(energy / 2500) * 1.2);
          showNotification('Research Complete', 'Prestige points gained increased by 20%!');
        }
      }
    ];
    const achievementDefinitions = [
      {
        id: 'firstClick',
        name: 'First Click',
        description: 'Click the collector for the first time.',
        icon: 'üëÜ',
        checkCondition: () => gameState.totalClicks >= 1,
        hidden: false
      },
      {
        id: 'tenClicks',
        name: 'Getting Started',
        description: 'Click the collector 10 times.',
        icon: 'üîü',
        checkCondition: () => gameState.totalClicks >= 10,
        hidden: false
      },
      {
        id: 'hundredClicks',
        name: 'Click Master',
        description: 'Click the collector 100 times.',
        icon: 'üíØ',
        checkCondition: () => gameState.totalClicks >= 100,
        hidden: false
      },
      {
        id: 'thousandClicks',
        name: 'Click Virtuoso',
        description: 'Click the collector 1,000 times.',
        icon: 'üñ±Ô∏è',
        checkCondition: () => gameState.totalClicks >= 1000,
        hidden: false
      },
      {
        id: 'firstUpgrade',
        name: 'Upgrader',
        description: 'Purchase your first upgrade.',
        icon: 'üîº',
        checkCondition: () => Object.values(gameState.upgrades).some((u) => u > 0),
        hidden: false
      },
      {
        id: 'fiveUpgrades',
        name: 'Upgrade Enthusiast',
        description: 'Purchase 5 levels of any upgrade.',
        icon: '‚è´',
        checkCondition: () => Object.values(gameState.upgrades).some((u) => u >= 5),
        hidden: false
      },
      {
        id: 'thousandEnergy',
        name: 'Energy Wealthy',
        description: 'Have 1,000 energy at once.',
        icon: 'üí∞',
        checkCondition: () => gameState.energy >= 1000,
        hidden: false
      },
      {
        id: 'millionEnergy',
        name: 'Energy Magnate',
        description: 'Have 1,000,000 energy at once.',
        icon: 'üíé',
        checkCondition: () => gameState.energy >= 1000000,
        hidden: false
      },
      {
        id: 'firstResearch',
        name: 'Researcher',
        description: 'Complete your first research.',
        icon: 'üî¨',
        checkCondition: () => Object.values(gameState.research).some((r) => r === true),
        hidden: false
      },
      {
        id: 'threeResearch',
        name: 'Scientist',
        description: 'Complete 3 different research projects.',
        icon: 'üß™',
        checkCondition: () =>
          Object.values(gameState.research).filter((r) => r === true).length >= 3,
        hidden: false
      },
      {
        id: 'firstStardust',
        name: 'Stardust Collector',
        description: 'Collect your first Stardust.',
        icon: '‚≠ê',
        checkCondition: () => gameState.stardust >= 1,
        hidden: false
      },
      {
        id: 'hundredStardust',
        name: 'Cosmic Dust',
        description: 'Collect 100 Stardust.',
        icon: '‚ú®',
        checkCondition: () => gameState.stardust >= 100,
        hidden: false
      },
      {
        id: 'firstAscension',
        name: 'Ascended',
        description: 'Perform your first Ascension.',
        icon: 'üå†',
        checkCondition: () => gameState.prestigePoints >= 1,
        hidden: false
      },
      {
        id: 'thirdAscension',
        name: 'Celestial Being',
        description: 'Perform 3 Ascensions.',
        icon: 'üëº',
        checkCondition: () => gameState.prestigePoints >= 3,
        hidden: false,
        bonusDesc: '+10% energy from clicks'
      }
    ];
    const artifactDefinitions = [
      {
        id: 'energyCrystal',
        name: 'Energy Crystal',
        description: 'A crystal that amplifies passive energy production.',
        rarity: 'common',
        effect: {type: 'energyMultiplier', value: 1.1}
      },
      {
        id: 'cosmicShard',
        name: 'Cosmic Shard',
        description: 'A shard that enhances click power.',
        rarity: 'common',
        effect: {type: 'clickMultiplier', value: 1.15}
      },
      {
        id: 'starFragment',
        name: 'Star Fragment',
        description: 'A fragment from a distant star that boosts stardust production.',
        rarity: 'uncommon',
        effect: {type: 'stardustBonus', value: 0.25}
      },
      {
        id: 'quantumLens',
        name: 'Quantum Lens',
        description:
          'Focuses cosmic rays for more click power, but reduces passive energy (-10%).',
        rarity: 'uncommon',
        effect: {
          type: 'clickMultiplier',
          value: 1.25,
          sideEffect: {type: 'energyMultiplier', value: 0.9}
        }
      },
      {
        id: 'dustyComet',
        name: 'Dusty Comet',
        description:
          'A comet that leaves a trail of stardust with every click (+30% stardust per click).',
        rarity: 'rare',
        effect: {type: 'stardustBonus', value: 0.3, onlyOnClick: true}
      },
      {
        id: 'researchTome',
        name: 'Research Tome',
        description: 'Ancient knowledge that speeds up research.',
        rarity: 'rare',
        effect: {type: 'researchSpeed', value: 1.5}
      },
      {
        id: 'celestialCore',
        name: 'Celestial Core',
        description: 'A core that boosts all production.',
        rarity: 'rare',
        effect: {type: 'allProduction', value: 1.2}
      },
      {
        id: 'ancientRelic',
        name: 'Ancient Relic',
        description: 'A relic that increases prestige points gained.',
        rarity: 'epic',
        effect: {type: 'prestigeBonus', value: 1.4}
      },
      {
        id: 'voidFragment',
        name: 'Void Fragment',
        description: 'A fragment from the void: +30% all production, disables click upgrades.',
        rarity: 'epic',
        effect: {type: 'allProduction', value: 1.3, disables: 'clickUpgrades'}
      },
      {
        id: 'stellarBattery',
        name: 'Stellar Battery',
        description: 'Stores cosmic energy for a burst: +25% energy/s, disables stardust gain.',
        rarity: 'epic',
        effect: {type: 'energyMultiplier', value: 1.25, disables: 'stardust'}
      }
    ];
    const elements = {
      energyValue: document.getElementById('energyValue'),
      energyPerSecond: document.getElementById('energyPerSecond'),
      stardustValue: document.getElementById('stardustValue'),
      stardustPerSecond: document.getElementById('stardustPerSecond'),
      prestigeValue: document.getElementById('prestigeValue'),
      clickerButton: document.getElementById('clickerButton'),
      clickValue: document.getElementById('clickValue'),
      autoClickValue: document.getElementById('autoClickValue'),
      tabs: document.querySelectorAll('.tab'),
      tabContents: document.querySelectorAll('.tab-content'),
      upgradesContainer: document.getElementById('upgradesContainer'),
      researchContainer: document.getElementById('researchContainer'),
      achievementsContainer: document.getElementById('achievementsContainer'),
      artifactsContainer: document.getElementById('artifactsContainer'),
      equippedArtifacts: document.getElementById('equippedArtifacts'),
      discoverArtifactButton: document.getElementById('discoverArtifactButton'),
      prestigeButton: document.getElementById('prestigeButton'),
      prestigeReward: document.getElementById('prestigeReward'),
      settingsModal: document.getElementById('settingsModal'),
      resetConfirmModal: document.getElementById('resetConfirmModal'),
      settingsButton: document.getElementById('settingsButton'),
      closeSettings: document.getElementById('closeSettings'),
      saveButton: document.getElementById('saveButton'),
      resetButton: document.getElementById('resetButton'),
      cancelResetButton: document.getElementById('cancelResetButton'),
      confirmResetButton: document.getElementById('confirmResetButton'),
      notification: document.getElementById('notification'),
      notificationTitle: document.getElementById('notificationTitle'),
      notificationMessage: document.getElementById('notificationMessage'),
      starsBg: document.getElementById('starsBg')
    };
    function formatNumber(num) {
      if (num < 1000) return num.toFixed(0);
      const units = ['', 'K', 'M', 'B', 'T', 'Qa', 'Qi', 'Sx', 'Sp', 'Oc', 'No', 'Dc'];
      const k = 1000;
      const magnitude = Math.floor(Math.log(num) / Math.log(k));
      return (num / Math.pow(k, magnitude)).toFixed(2) + units[magnitude];
    }
    function formatDecimal(num) {
      if (num < 10) return num.toFixed(1);
      return formatNumber(num);
    }
    function calculateUpgradeCost(upgrade, level) {
      return Math.floor(upgrade.baseCost * Math.pow(upgrade.costGrowth, level));
    }
    function calculateEnergyPerSecond() {
      let total = 0;
      for (const [id, level] of Object.entries(gameState.upgrades)) {
        const upgrade = upgradeDefinitions.find((u) => u.id === id);
        if (upgrade && upgrade.baseProduction) {
          const productionPerItem =
            upgrade.baseProduction + upgrade.productionGrowth * (level - 1);
          total += productionPerItem * level;
        }
      }
      total *= 1 + gameState.prestigePoints * 0.1;
      gameState.artifacts.forEach((artifact, idx) => {
        if (gameState.artifactSlots.includes(idx)) {
          const value = getArtifactEffectValue(artifact);
          if (
            artifact.effect.type === 'energyMultiplier' ||
            artifact.effect.type === 'allProduction'
          ) {
            total *= value;
          }
        }
      });
      return total;
    }
    function calculateStardustPerSecond() {
      let total = 0;
      const stardustCollector = upgradeDefinitions.find((u) => u.id === 'stardustCollector');
      const collectorLevel = gameState.upgrades['stardustCollector'] || 0;
      if (collectorLevel > 0) {
        total +=
          stardustCollector.stardustProduction +
          stardustCollector.stardustGrowth * (collectorLevel - 1) * collectorLevel;
      }
      total *= 1 + gameState.prestigePoints * 0.05;
      let stardustBonusMultiplier = 1;
      let allProductionMultiplier = 1;
      gameState.artifacts.forEach((artifact, idx) => {
        if (gameState.artifactSlots.includes(idx)) {
          const value = getArtifactEffectValue(artifact);
          if (artifact.effect.type === 'stardustBonus') {
            stardustBonusMultiplier *= 1 + value;
          }
          if (artifact.effect.type === 'allProduction') {
            allProductionMultiplier *= value;
          }
        }
      });
      total *= stardustBonusMultiplier;
      total *= allProductionMultiplier;
      return total;
    }
    function calculateEnergyPerClick() {
      let base = 1;
      for (const [id, level] of Object.entries(gameState.upgrades)) {
        const upgrade = upgradeDefinitions.find((u) => u.id === id);
        if (upgrade && upgrade.clickIncrease) {
          base += upgrade.clickIncrease * level;
        }
      }
      if (gameState.research && gameState.research['enhancedClicking']) {
        base *= 1.3;
      }
      gameState.artifacts.forEach((artifact, idx) => {
        if (gameState.artifactSlots.includes(idx)) {
          const value = getArtifactEffectValue(artifact);
          if (artifact.effect.type === 'clickMultiplier') {
            base *= value;
          }
          if (artifact.effect.type === 'allProduction') {
            base *= value;
          }
        }
      });
      base *= config.clickMultiplier || 1;
      return base;
    }
    function createPopEffect(x, y, value) {
      const popElement = document.createElement('div');
      popElement.className = 'pop-effect';
      popElement.textContent = `+${formatNumber(value)}`;
      popElement.style.left = `${x}px`;
      popElement.style.top = `${y}px`;
      document.body.appendChild(popElement);
      setTimeout(() => {
        document.body.removeChild(popElement);
      }, 1500);
    }
    function showNotification(title, message) {
      elements.notificationTitle.textContent = title;
      elements.notificationMessage.textContent = message;
      elements.notification.classList.add('show');
      setTimeout(() => {
        elements.notification.classList.remove('show');
      }, 3000);
    }
    function updateUI() {
      elements.energyValue.textContent = formatNumber(gameState.energy);
      elements.energyPerSecond.textContent = `${formatDecimal(gameState.energyPerSecond)} per second`;
      if (gameState.unlocked.stardust) {
        elements.stardustValue.textContent = formatNumber(gameState.stardust);
        elements.stardustPerSecond.textContent = `${formatDecimal(gameState.stardustPerSecond)} per second`;
      }
      // Always use a fresh DOM reference for prestigeValue
      const prestigeValueElem = document.getElementById('prestigeValue');
      console.log(
        'Prestige points:',
        gameState.prestigePoints,
        'Unlocked:',
        gameState.unlocked.prestige
      );
      if ((gameState.unlocked.prestige || gameState.prestigePoints > 0) && prestigeValueElem) {
        prestigeValueElem.textContent = formatNumber(gameState.prestigePoints);
        document.getElementById('prestigeResource').style.display = 'flex';
      }
      gameState.energyPerClick = calculateEnergyPerClick();
      elements.clickValue.textContent = gameState.energyPerClick.toFixed(2);
      elements.autoClickValue.textContent = formatDecimal(gameState.energyPerSecond);
      elements.prestigeReward.textContent = formatNumber(
        config.prestigePointsFormula(gameState.energy)
      );
      if (gameState.energy >= config.prestigeRequirement) {
        elements.prestigeButton.disabled = false;
      } else {
        elements.prestigeButton.disabled = true;
      }
      if (elements.discoverArtifactButton) {
        elements.discoverArtifactButton.disabled = !(
          gameState.unlocked.stardust && gameState.stardust >= 100
        );
      }
      renderUpgrades();
      if (gameState.activeResearch) {
        const researchItem = document.getElementById(`research-${gameState.activeResearch}`);
        if (researchItem) {
          const progressBar = researchItem.querySelector('.research-progress-bar');
          const researchDef = researchDefinitions.find((r) => r.id === gameState.activeResearch);
          if (progressBar && researchDef) {
            const progressPercent = (gameState.researchProgress / researchDef.duration) * 100;
            progressBar.style.width = `${progressPercent}%`;
          }
        }
      }
      let researchSpeed = 1;
      gameState.artifacts.forEach((artifact, idx) => {
        if (gameState.artifactSlots.includes(idx) && artifact.effect.type === 'researchSpeed') {
          researchSpeed *= artifact.effect.value;
        }
      });
      gameState.researchSpeedMultiplier = researchSpeed;
    }
    function renderUpgrades() {
      elements.upgradesContainer.innerHTML = '';
      for (const upgrade of upgradeDefinitions) {
        if (gameState.totalEnergy < upgrade.unlockRequirement) continue;
        if (upgrade.requiresResearch && !gameState.research[upgrade.requiresResearch]) continue;
        const level = gameState.upgrades[upgrade.id] || 0;
        const cost = calculateUpgradeCost(upgrade, level + 1);
        const isAffordable = gameState.energy >= cost;
        const upgradeElement = document.createElement('div');
        upgradeElement.className = `upgrade ${isAffordable ? '' : 'disabled'}`;
        upgradeElement.id = `upgrade-${upgrade.id}`;
        let effectText = '';
        if (upgrade.baseProduction) {
          const currentProduction =
            level > 0
              ? upgrade.baseProduction + upgrade.productionGrowth * (level - 1)
              : upgrade.baseProduction;
          effectText = `+${formatDecimal(currentProduction)} energy/s each`;
        } else if (upgrade.clickIncrease) {
          effectText = `+${formatNumber(upgrade.clickIncrease)} energy per click each`;
        } else if (upgrade.stardustProduction) {
          const currentProduction =
            level > 0
              ? upgrade.stardustProduction + upgrade.stardustGrowth * (level - 1)
              : upgrade.stardustProduction;
          effectText = `+${formatDecimal(currentProduction)} stardust/s each`;
        }
        upgradeElement.innerHTML = `
      <div class="upgrade-info">
        <div class="upgrade-name">
          <span class="upgrade-icon">${upgrade.icon}</span>
          ${upgrade.name}
          ${level > 0 ? `<span class="upgrade-level">Lvl ${level}</span>` : ''}
        </div>
        <div class="upgrade-desc">${upgrade.description}</div>
        <div class="upgrade-effect">${effectText}</div>
      </div>
      <div class="upgrade-cost ${isAffordable ? 'affordable' : 'not-affordable'}">
        ${formatNumber(cost)}
      </div>
      <div class="progress-bar" style="width: 0%"></div>
    `;
        upgradeElement.addEventListener('click', () => {
          if (isAffordable) {
            gameState.energy -= cost;
            gameState.upgrades[upgrade.id] = (gameState.upgrades[upgrade.id] || 0) + 1;
            gameState.energyPerSecond = calculateEnergyPerSecond();
            if (gameState.unlocked.stardust) {
              gameState.stardustPerSecond = calculateStardustPerSecond();
            }
            gameState.energyPerClick = calculateEnergyPerClick();
            updateUI();
            const progressBar = upgradeElement.querySelector('.progress-bar');
            progressBar.style.width = '100%';
            setTimeout(() => {
              progressBar.style.width = '0%';
            }, 500);
            showNotification(
              'Upgrade Purchased',
              `You purchased ${upgrade.name} level ${gameState.upgrades[upgrade.id]}`
            );
            checkAchievements();
          }
        });
        elements.upgradesContainer.appendChild(upgradeElement);
      }
    }
    function renderResearch() {
      const inProgressSection = document.getElementById('researchInProgressSection');
      const availableSection = document.getElementById('availableResearchSection');
      const completedSection = document.getElementById('completedResearchSection');
      if (inProgressSection) inProgressSection.innerHTML = '';
      if (availableSection) availableSection.innerHTML = '';
      if (completedSection) completedSection.innerHTML = '';
      const inProgress = [];
      const available = [];
      const completed = [];
      for (const research of researchDefinitions) {
        const isResearched = gameState.research[research.id] === true;
        const isUnlocked = gameState.totalEnergy >= research.unlockRequirement;
        if (!isUnlocked) continue;
        if (research.requiresResearch && !gameState.research[research.requiresResearch]) continue;
        const isInProgress = gameState.activeResearch === research.id;
        if (isResearched) completed.push(research);
        else if (isInProgress) inProgress.push(research);
        else available.push(research);
      }
      if (inProgressSection && inProgress.length > 0) {
        inProgressSection.innerHTML =
          '<h3 style="color:var(--accent);margin-bottom:8px;">In Progress</h3>';
        inProgress.forEach((research) => {
          const researchElement = document.createElement('div');
          researchElement.className = 'research-item in-progress';
          researchElement.id = `research-${research.id}`;
          const minutes = Math.floor(research.duration / 60);
          const seconds = (research.duration % 60).toString().padStart(2, '0');
          const progressPercent = (gameState.researchProgress / research.duration) * 100;
          researchElement.innerHTML = `
        <div class="research-name">${research.name}</div>
        <div class="research-desc">${research.description}</div>
        <div class="research-cost">Time: ${minutes}:${seconds}</div>
        <div class="research-progress">
          <div class="research-progress-bar" style="width: ${progressPercent}%"></div>
        </div>
      `;
          inProgressSection.appendChild(researchElement);
        });
      }

      if (availableSection && available.length > 0) {
        availableSection.innerHTML =
          '<h3 style="color:var(--accent);margin-bottom:8px;">Available Research</h3>';
        available.forEach((research) => {
          const isAffordable = gameState.energy >= research.cost;
          const researchElement = document.createElement('div');
          researchElement.className = 'research-item' + (isAffordable ? '' : ' locked');
          researchElement.id = `research-${research.id}`;
          const minutes = Math.floor(research.duration / 60);
          const seconds = (research.duration % 60).toString().padStart(2, '0');
          researchElement.innerHTML = `
        <div class="research-name">${research.name}</div>
        <div class="research-desc">${research.description}</div>
        <div class="research-cost">Cost: ${formatNumber(research.cost)} energy | Time: ${minutes}:${seconds}</div>
      `;
          if (isAffordable && !gameState.activeResearch) {
            researchElement.addEventListener('click', () => {
              gameState.energy -= research.cost;
              gameState.activeResearch = research.id;
              gameState.researchProgress = 0;
              updateUI();
              renderResearch();
              showNotification('Research Started', `You started researching ${research.name}`);
              setupTabs();
            });
          }
          availableSection.appendChild(researchElement);
        });
      }

      if (completedSection && completed.length > 0) {
        completedSection.innerHTML =
          '<h3 style="color:var(--accent);margin-bottom:8px;">Completed Research</h3>';
        completed.forEach((research) => {
          const researchElement = document.createElement('div');
          researchElement.className = 'research-item researched';
          researchElement.id = `research-${research.id}`;
          researchElement.innerHTML = `
        <div class="research-name">${research.name}</div>
        <div class="research-desc">${research.description}</div>
      `;
          completedSection.appendChild(researchElement);
        });
      }
    }
    function renderAchievements() {
      elements.achievementsContainer.innerHTML = '';
      for (const achievement of achievementDefinitions) {
        const isUnlocked = gameState.achievements[achievement.id] === true;
        const achievementElement = document.createElement('div');
        achievementElement.className = `achievement ${isUnlocked ? 'unlocked' : 'locked'}`;
        achievementElement.innerHTML = `
      <div class="achievement-icon">${achievement.icon}</div>
      <div class="achievement-name">${achievement.name}</div>
      <div class="achievement-desc">${achievement.description}</div>
      ${achievement.bonusDesc && isUnlocked ? `<div class="upgrade-effect">${achievement.bonusDesc}</div>` : ''}
    `;
        elements.achievementsContainer.appendChild(achievementElement);
      }
    }
    function renderArtifacts() {
      if (!elements.artifactsContainer) return;
      elements.artifactsContainer.innerHTML = '';
      gameState.artifacts.forEach((artifact, index) => {
        const isEquipped = gameState.artifactSlots.includes(index);
        let rarityColor = 'var(--text)';
        switch (artifact.rarity) {
          case 'uncommon':
            rarityColor = '#2dce89';
            break;
          case 'rare':
            rarityColor = '#5e72e4';
            break;
          case 'epic':
            rarityColor = '#fb6ed3';
            break;
        }
        let effectText = '';
        let value = getArtifactEffectValue(artifact);
        switch (artifact.effect.type) {
          case 'energyMultiplier':
            effectText = `+${Math.round((value - 1) * 100)}% energy production`;
            break;
          case 'clickMultiplier':
            effectText = `+${Math.round((value - 1) * 100)}% click power`;
            break;
          case 'stardustBonus':
            effectText = `+${Math.round(value * 100)}% stardust production`;
            break;
          case 'allProduction':
            effectText = `+${Math.round((value - 1) * 100)}% all production`;
            break;
          case 'prestigeBonus':
            effectText = `+${Math.round((value - 1) * 100)}% prestige points`;
            break;
          case 'researchSpeed':
            effectText = `+${Math.round((value - 1) * 100)}% research speed`;
            break;
        }
        const upgradeBtn =
          artifact.level && artifact.level < 5
            ? `<button class="modal-button" style="margin-left:10px;" onclick="window.upgradeArtifact(${index})">Upgrade (${artifact.level}/5)</button>`
            : `<span style="margin-left:10px; color:var(--text-secondary);">Max</span>`;
        const artifactElement = document.createElement('div');
        artifactElement.className = `upgrade ${isEquipped ? 'equipped' : ''}`;
        artifactElement.innerHTML = `
      <div class="upgrade-info">
        <div class="upgrade-name">
          <span class="upgrade-icon">üîÆ</span>
          ${artifact.name}
          <span class="upgrade-level" style="background-color: ${rarityColor};">${artifact.rarity} Lvl ${artifact.level || 1}</span>
        </div>
        <div class="upgrade-desc">${artifact.description}</div>
        <div class="upgrade-effect">${effectText}</div>
      </div>
      <div class="upgrade-cost ${isEquipped ? 'equipped' : ''}">
        ${isEquipped ? 'Unequip' : 'Equip'}
        ${upgradeBtn}
      </div>
    `;
        artifactElement.addEventListener('click', (e) => {
          if (!e.target.closest('button')) toggleArtifact(index);
        });
        elements.artifactsContainer.appendChild(artifactElement);
      });
      if (!elements.equippedArtifacts) return;
      elements.equippedArtifacts.innerHTML = '';
      if (gameState.artifactSlots.length === 0) {
        elements.equippedArtifacts.innerHTML =
          '<div class="panel-subtitle">No artifacts equipped.</div>';
      } else {
        gameState.artifactSlots.forEach((slotIndex) => {
          const artifact = gameState.artifacts[slotIndex];
          if (artifact) {
            const slotElement = document.createElement('div');
            slotElement.className = 'research-item equipped';
            slotElement.innerHTML = `
          <div class="research-name">${artifact.name} (Lvl ${artifact.level || 1})</div>
          <div class="research-desc">${artifact.description}</div>
        `;
            elements.equippedArtifacts.appendChild(slotElement);
          }
        });
      }
    }
    function checkAchievements() {
      let newAchievements = false;
      for (const achievement of achievementDefinitions) {
        if (!gameState.achievements[achievement.id] && achievement.checkCondition()) {
          gameState.achievements[achievement.id] = true;
          newAchievements = true;
          showNotification('Achievement Unlocked', `${achievement.name}`);
          if (achievement.id === 'thirdAscension') {
            config.clickMultiplier = 1.1;
          }
        }
      }
      if (newAchievements) {
        renderAchievements();
      }
    }
    function updateResearch(deltaTime) {
      if (gameState.activeResearch) {
        const research = researchDefinitions.find((r) => r.id === gameState.activeResearch);
        if (research) {
          gameState.researchProgress += deltaTime / 1000;
          if (gameState.researchProgress >= research.duration) {
            gameState.research[research.id] = true;
            gameState.activeResearch = null;
            gameState.researchProgress = 0;
            research.effect();
            gameState.energyPerClick = calculateEnergyPerClick();
            renderResearch();
            updateUI();
            checkAchievements();
          }
        }
      }
    }
    function createSparkles(count = 5) {
      const starSystem = document.querySelector('.star-system');
      const rect = starSystem.getBoundingClientRect();
      for (let i = 0; i < count; i++) {
        const sparkle = document.createElement('div');
        sparkle.className = 'sparkle';
        sparkle.style.left = `${Math.random() * rect.width}px`;
        sparkle.style.top = `${Math.random() * rect.height}px`;
        sparkle.style.position = 'absolute';
        starSystem.appendChild(sparkle);
        setTimeout(() => {
          sparkle.remove();
        }, 500);
      }
    }
    function toggleArtifact(index) {
      if (gameState.artifactSlots.includes(index)) {
        gameState.artifactSlots = gameState.artifactSlots.filter((i) => i !== index);
      } else {
        if (gameState.artifactSlots.length < 3) {
          gameState.artifactSlots.push(index);
        } else {
          showNotification('Artifact Slots Full', 'Unequip an artifact first to equip this one.');
          return;
        }
      }
      gameState.energyPerSecond = calculateEnergyPerSecond();
      if (gameState.unlocked.stardust) {
        gameState.stardustPerSecond = calculateStardustPerSecond();
      }
      gameState.energyPerClick = calculateEnergyPerClick();
      renderArtifacts();
      updateUI();
    }
    function discoverArtifact() {
      if (gameState.stardust < 100) return;
      gameState.stardust -= 100;
      const rarityRoll = Math.random();
      let rarity = 'common';
      if (rarityRoll > 0.98) rarity = 'epic';
      else if (rarityRoll > 0.85) rarity = 'rare';
      else if (rarityRoll > 0.6) rarity = 'uncommon';
      const possibleArtifacts = artifactDefinitions.filter(
        (a) => a.rarity === rarity && !gameState.artifacts.some((ga) => ga.id === a.id)
      );
      if (possibleArtifacts.length === 0) {
        const total = artifactDefinitions.filter((a) => a.rarity === rarity).length;
        const owned = gameState.artifacts.filter((a) =>
          artifactDefinitions.find((def) => def.id === a.id && def.rarity === rarity)
        ).length;
        const percent = Math.round((100 * (total - owned)) / total);
        showNotification(
          'No More Artifacts',
          `You have all ${rarity} artifacts. Chance to get a new one: ${percent}%`
        );
        updateUI();
        return;
      }
      const selectedArtifact =
        possibleArtifacts[Math.floor(Math.random() * possibleArtifacts.length)];
      gameState.artifacts.push({...selectedArtifact, level: 1});
      showNotification('Artifact Discovered', `You found a ${rarity} ${selectedArtifact.name}!`);
      renderArtifacts();
      updateUI();
    }
    function createStars() {
      const starsContainer = elements.starsBg;
      for (let i = 0; i < 100; i++) {
        const star = document.createElement('div');
        star.className = 'star-bg';
        const size = Math.random() * 3 + 1;
        star.style.width = `${size}px`;
        star.style.height = `${size}px`;
        star.style.top = `${Math.random() * 100}%`;
        star.style.left = `${Math.random() * 100}%`;
        star.style.animationDuration = `${Math.random() * 3 + 2}s`;
        starsContainer.appendChild(star);
      }
    }
    function setupTabs() {
      elements.tabs = document.querySelectorAll('.tab');
      elements.tabContents = document.querySelectorAll('.tab-content');
      elements.tabs.forEach((tab) => {
        const clone = tab.cloneNode(true);
        tab.parentNode.replaceChild(clone, tab);
      });
      elements.tabs = document.querySelectorAll('.tab');
      elements.tabs.forEach((tab) => {
        tab.addEventListener('click', () => {
          elements.tabs.forEach((t) => t.classList.remove('active'));
          elements.tabContents.forEach((c) => c.classList.remove('active'));
          tab.classList.add('active');
          const tabId = tab.getAttribute('data-tab');
          document.getElementById(`${tabId}Tab`).classList.add('active');
          if (tabId === 'artifacts') {
            renderArtifacts();
            // renderArtifactChances(); // REMOVE this line to fix ReferenceError
          }
        });
      });
    }
    function setupTabsAfterLoad() {
      setupTabs();
    }
    function setupModals() {
      elements.settingsButton.addEventListener('click', () => {
        elements.settingsModal.classList.add('active');
      });
      elements.closeSettings.addEventListener('click', () => {
        elements.settingsModal.classList.remove('active');
      });
      elements.resetButton.addEventListener('click', () => {
        elements.resetConfirmModal.classList.add('active');
        elements.settingsModal.classList.remove('active');
      });
      elements.cancelResetButton.addEventListener('click', () => {
        elements.resetConfirmModal.classList.remove('active');
      });
      elements.confirmResetButton.addEventListener('click', () => {
        resetGame();
        elements.resetConfirmModal.classList.remove('active');
        showNotification('Game Reset', 'Your game has been reset.');
      });
      elements.saveButton.addEventListener('click', () => {
        saveGame();
        elements.settingsModal.classList.remove('active');
        showNotification('Game Saved', 'Your game has been saved.');
      });
    }
    function setupClicker() {
      elements.clickerButton.addEventListener('click', (e) => {
        const rect = elements.clickerButton.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        const clickAmount = gameState.energyPerClick;
        gameState.energy += clickAmount;
        gameState.totalEnergy += clickAmount;
        gameState.totalClicks++;
        checkUnlocks();
        createPopEffect(e.clientX, e.clientY, clickAmount);
        createSparkles(2);
        updateUI();
        checkAchievements();
      });
    }
    function setupPrestige() {
      elements.prestigeButton.addEventListener('click', () => {
        if (gameState.energy >= config.prestigeRequirement) {
          let prestigePoints = config.prestigePointsFormula(gameState.energy);
          // Debug log for ascension
          console.log(
            'Energy at ascension:',
            gameState.energy,
            'Total energy:',
            gameState.totalEnergy,
            'Prestige points to gain:',
            prestigePoints
          );
          gameState.artifacts.forEach((artifact) => {
            if (gameState.artifactSlots.includes(gameState.artifacts.indexOf(artifact))) {
              if (artifact.effect.type === 'prestigeBonus') {
                prestigePoints = Math.floor(prestigePoints * artifact.effect.value);
              }
            }
          });
          const oldPrestigePoints = gameState.prestigePoints;
          const oldAchievements = {...gameState.achievements};
          const oldResearch = {...gameState.research};
          const oldArtifacts = [...gameState.artifacts];
          const oldArtifactSlots = [...gameState.artifactSlots];
          const oldUnlocked = {...gameState.unlocked};
          resetGame(false);
          gameState.unlocked = oldUnlocked;
          gameState.achievements = oldAchievements;
          gameState.research = oldResearch;
          gameState.artifacts = oldArtifacts;
          gameState.artifactSlots = oldArtifactSlots;
          gameState.prestigePoints = oldPrestigePoints + prestigePoints;
          console.log('Prestige points after ascension:', gameState.prestigePoints);
          if (gameState.unlocked.stardust) {
            document.getElementById('stardustResource').style.display = 'flex';
          }
          if (gameState.unlocked.prestige) {
            document.getElementById('prestigeResource').style.display = 'flex';
            document.getElementById('ascensionTab').style.display = '';
          }
          if (
            gameState.unlocked.stardust &&
            !document.querySelector('.tab[data-tab="artifacts"]')
          ) {
            createArtifactTab();
          }
          gameState.energyPerSecond = calculateEnergyPerSecond();
          if (gameState.unlocked.stardust) {
            gameState.stardustPerSecond = calculateStardustPerSecond();
          }
          updateUI();
          renderResearch();
          renderAchievements();
          renderArtifacts();
          console.log('Prestige points after load:', gameState.prestigePoints);
          showNotification('Ascension Complete', `You gained ${prestigePoints} Celestial Power!`);
          checkAchievements();
        }
      });
    }
    function setupArtifacts() {
      if (elements.discoverArtifactButton) {
        elements.discoverArtifactButton.addEventListener('click', discoverArtifact);
      }
    }
    function checkUnlocks() {
      if (gameState.energy >= 100) {
        if (!gameState.unlocked.research) {
          gameState.unlocked.research = true;
          showNotification('Feature Unlocked', 'You can now conduct research!');
        }
        renderResearch();
        updateUI();
      }
    }
    function saveGame() {
      localStorage.setItem('cosmicClickerSave', JSON.stringify(gameState));
      gameState.lastSave = Date.now();
    }
    function loadGame() {
      const savedGame = localStorage.getItem('cosmicClickerSave');
      if (savedGame) {
        try {
          const parsedSave = JSON.parse(savedGame);
          // Merge defaults with loaded save
          gameState = {
            energy: 0,
            energyPerClick: 1,
            energyPerSecond: 0,
            stardust: 0,
            stardustPerSecond: 0,
            prestigePoints: 0,
            prestigeMultiplier: 1,
            totalClicks: 0,
            totalEnergy: 0,
            lastUpdate: Date.now(),
            lastSave: Date.now(),
            researchPoints: 0,
            researchPointsPerSecond: 0,
            starSystemLevel: 1,
            activeResearch: null,
            researchProgress: 0,
            achievements: {},
            upgrades: {},
            research: {},
            unlocked: {stardust: false, research: false, prestige: false},
            artifacts: [],
            artifactSlots: [],
            researchSpeedMultiplier: 1,
            ...parsedSave // loaded values overwrite defaults
          };
          const currentTime = Date.now();
          const offlineTime = Math.min(
            currentTime - parsedSave.lastUpdate,
            config.offlineProgressMax
          );
          if (offlineTime > 5000) {
            const offlineEarnings = (gameState.energyPerSecond * offlineTime) / 1000;
            let offlineStardust = 0;
            if (gameState.unlocked.stardust) {
              offlineStardust = (gameState.stardustPerSecond * offlineTime) / 1000;
              gameState.stardust += offlineStardust;
            }
            if (offlineEarnings > 0) {
              gameState.energy += offlineEarnings;
              gameState.totalEnergy += offlineEarnings;
              setTimeout(() => {
                let message = `You earned ${formatNumber(offlineEarnings)} energy while away!`;
                if (offlineStardust > 0) {
                  message += ` And ${formatNumber(offlineStardust)} stardust!`;
                }
                showNotification('Welcome Back', message);
              }, 1000);
            }
          }
          if (gameState.unlocked.stardust) {
            document.getElementById('stardustResource').style.display = 'flex';
          }
          if (gameState.unlocked.prestige) {
            document.getElementById('prestigeResource').style.display = 'flex';
            document.getElementById('ascensionTab').style.display = '';
          }
          if (!gameState.researchSpeedMultiplier) {
            gameState.researchSpeedMultiplier = 1;
          }
          if (!gameState.artifacts) {
            gameState.artifacts = [];
          }
          if (!gameState.artifactSlots) {
            gameState.artifactSlots = [];
          }
          gameState.energyPerSecond = calculateEnergyPerSecond();
          if (gameState.unlocked.stardust) {
            gameState.stardustPerSecond = calculateStardustPerSecond();
          }
          gameState.energyPerClick = calculateEnergyPerClick();
          createArtifactTab();
          updateUI();
          renderResearch();
          renderAchievements();
          renderArtifacts();
        } catch (error) {
          console.error('Error loading save:', error);
          showNotification('Error', 'Could not load your saved game.');
          // Optionally clear the corrupted save:
          // localStorage.removeItem('cosmicClickerSave');
        }
      }
      setupTabs();
    }
    function resetGame(resetEverything = true) {
      if (resetEverything) {
        gameState = {
          energy: 0,
          energyPerClick: 1,
          energyPerSecond: 0,
          stardust: 0,
          stardustPerSecond: 0,
          prestigePoints: 0,
          prestigeMultiplier: 1,
          totalClicks: 0,
          totalEnergy: 0,
          lastUpdate: Date.now(),
          lastSave: Date.now(),
          researchPoints: 0,
          researchPointsPerSecond: 0,
          starSystemLevel: 1,
          activeResearch: null,
          researchProgress: 0,
          achievements: {},
          upgrades: {},
          research: {},
          unlocked: {stardust: false, research: false, prestige: false},
          artifacts: [],
          artifactSlots: [],
          researchSpeedMultiplier: 1
        };
        document.getElementById('stardustResource').style.display = 'none';
        document.getElementById('prestigeResource').style.display = 'none';
      } else {
        gameState.energy = 0;
        gameState.energyPerClick = 1;
        gameState.energyPerSecond = 0;
        gameState.stardust = 0;
        gameState.stardustPerSecond = 0;
        gameState.totalClicks = 0;
        gameState.activeResearch = null;
        gameState.researchProgress = 0;
        gameState.upgrades = {};
        gameState.lastUpdate = Date.now();
      }

      if (gameState.energy >= 100) {
        gameState.unlocked.research = true;
        renderResearch();
        updateUI();
      }
      gameState.energyPerClick = calculateEnergyPerClick();
      saveGame();
      updateUI();
      renderResearch();
      renderAchievements();
      renderArtifacts();
    }
    function createArtifactTab() {
      const tabExists = document.querySelector('.tab[data-tab="artifacts"]');
      if (tabExists) return;
      const tabsContainer = document.querySelector('.tabs');
      const artifactTab = document.createElement('div');
      artifactTab.className = 'tab';
      artifactTab.setAttribute('data-tab', 'artifacts');
      artifactTab.textContent = 'Artifacts';
      tabsContainer.appendChild(artifactTab);
      setupTabs();
    }
    function gameLoop() {
      const currentTime = Date.now();
      const deltaTime = Math.min(currentTime - gameState.lastUpdate, 10000);
      const energyToAdd = (gameState.energyPerSecond * deltaTime) / 1000;
      if (energyToAdd > 0) {
        gameState.energy += energyToAdd;
        gameState.totalEnergy += energyToAdd;
        checkUnlocks();
      }
      if (gameState.unlocked.stardust) {
        const stardustToAdd = (gameState.stardustPerSecond * deltaTime) / 1000;
        if (stardustToAdd > 0) {
          gameState.stardust += stardustToAdd;
        }
      }
      updateResearch(deltaTime);
      if (currentTime - gameState.lastSave >= config.autosaveInterval) {
        saveGame();
      }
      gameState.lastUpdate = currentTime;
      updateUI();
      setTimeout(gameLoop, config.updateInterval);
    }
    function init() {
      createStars();
      setupTabs();
      setupModals();
      setupClicker();
      setupPrestige();
      setupArtifacts();
      loadGame();
      gameLoop();
      setupTabsAfterLoad();
    }
    window.toggleArtifact = toggleArtifact;
    window.discoverArtifact = discoverArtifact;
    window.upgradeArtifact = function (index) {
      const artifact = gameState.artifacts[index];
      if (!artifact || artifact.level >= 5) return;
      const upgradeCost = artifact.level * 100;
      if (gameState.stardust < upgradeCost) {
        showNotification(
          'Not enough stardust',
          `You need ${upgradeCost} stardust to upgrade this artifact.`
        );
        return;
      }
      gameState.stardust -= upgradeCost;
      artifact.level = (artifact.level || 1) + 1;
      gameState.energyPerSecond = calculateEnergyPerSecond();
      if (gameState.unlocked.stardust) {
        gameState.stardustPerSecond = calculateStardustPerSecond();
      }
      gameState.energyPerClick = calculateEnergyPerClick();
      showNotification('Artifact Upgraded', `${artifact.name} is now level ${artifact.level}!`);
      renderArtifacts();
      updateUI();
    };
    document.addEventListener('DOMContentLoaded', function () {
      init();
      const exportBtn = document.getElementById('exportSaveButton');
      if (exportBtn) exportBtn.addEventListener('click', exportSave);
      const importBtn = document.getElementById('importSaveButton');
      if (importBtn) importBtn.addEventListener('click', importSave);
      const importModal = document.getElementById('importModal');
      const closeImportModal = document.getElementById('closeImportModal');
      const importBase64Button = document.getElementById('importBase64Button');
      const importBase64Input = document.getElementById('importBase64Input');
      if (closeImportModal)
        closeImportModal.addEventListener('click', () => {
          importModal.classList.remove('active');
          importBase64Input.value = '';
        });
      if (importBase64Button)
        importBase64Button.addEventListener('click', () => {
          const base64 = importBase64Input.value.trim();
          if (!base64) {
            showNotification('Import Failed', 'No base64 string provided.');
            return;
          }
          try {
            const json = decodeURIComponent(escape(atob(base64)));
            const imported = JSON.parse(json);
            if (imported && typeof imported === 'object' && imported.energy !== undefined) {
              gameState = imported;
              saveGame();
              updateUI();
              renderResearch();
              renderAchievements();
              renderArtifacts();
              showNotification('Import Successful', 'Save loaded!');
              importModal.classList.remove('active');
              importBase64Input.value = '';
            } else {
              showNotification('Import Failed', 'Invalid save string.');
            }
          } catch (err) {
            showNotification('Import Failed', 'Could not parse base64 string.');
          }
        });
      // Export modal logic
      const exportModal = document.getElementById('exportModal');
      const closeExportModal = document.getElementById('closeExportModal');
      const exportBase64Output = document.getElementById('exportBase64Output');
      const copyExportBase64Button = document.getElementById('copyExportBase64Button');
      const downloadExportBase64Button = document.getElementById('downloadExportBase64Button');
      if (closeExportModal)
        closeExportModal.addEventListener('click', () => {
          exportModal.classList.remove('active');
          exportBase64Output.value = '';
        });
      if (copyExportBase64Button)
        copyExportBase64Button.addEventListener('click', () => {
          if (exportBase64Output && exportBase64Output.value) {
            navigator.clipboard.writeText(exportBase64Output.value).then(
              () => {
                showNotification('Copied', 'Base64 save copied to clipboard!');
              },
              () => {
                showNotification('Copy Failed', 'Could not copy to clipboard.');
              }
            );
          }
        });
      if (downloadExportBase64Button)
        downloadExportBase64Button.addEventListener('click', () => {
          if (exportBase64Output && exportBase64Output.value) {
            const blob = new Blob([exportBase64Output.value], {type: 'text/plain'});
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'cosmic_clicker_save.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showNotification('Export Successful', 'Base64 save downloaded as file!');
          }
        });
    });

    function exportSave() {
      const exportModal = document.getElementById('exportModal');
      const exportBase64Output = document.getElementById('exportBase64Output');
      if (exportModal && exportBase64Output) {
        // Convert gameState to base64
        const json = JSON.stringify(gameState);
        const base64 = btoa(unescape(encodeURIComponent(json)));
        exportBase64Output.value = base64;
        exportModal.classList.add('active');
      }
    }

    function importSave() {
      const importModal = document.getElementById('importModal');
      if (importModal) {
        importModal.classList.add('active');
      }
    }

    function getArtifactEffectValue(artifact) {
      let base = artifact.effect.value;
      let lvl = artifact.level || 1;
      if (
        [
          'energyMultiplier',
          'clickMultiplier',
          'allProduction',
          'prestigeBonus',
          'researchSpeed'
        ].includes(artifact.effect.type)
      ) {
        return base * (1 + 0.2 * (lvl - 1));
      } else if (['stardustBonus'].includes(artifact.effect.type)) {
        return base + base * 0.2 * (lvl - 1);
      }
      return base;
    }
  </script>
</body>

</html>
